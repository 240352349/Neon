<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Search Results - Neon</title>
    <link rel="stylesheet" href="styles.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"/>
</head>
<body class="dark-mode lang-zh">
    <header>
        <div class="container">
            <div class="logo">Neon</div>
            <nav>
                <ul>
                    <li><a href="index.html#on-sale"><span class="lang-zh">ç‰¹åƒ¹å•†å“</span><span class="lang-en">On Sale</span></a></li>
                    <li><a href="index.html#new-arrivals"><span class="lang-zh">æ–°å“ä¸Šå¸‚</span><span class="lang-en">New Arrivals</span></a></li>
                    <li><a href="index.html#top-selling"><span class="lang-zh">ç†±é–€å•†å“</span><span class="lang-en">Top Selling</span></a></li>
                    <li><a href="index.html#customer-reviews"><span class="lang-zh">ç²‰çµ²è©•åƒ¹</span><span class="lang-en">Customer Reviews</span></a></li>
                </ul>
            </nav>
            <div class="header-right">
                <div class="search-bar">
                    <form action="search.html" method="get" id="searchForm">
                        <input type="text" name="query" id="searchInput" placeholder="Search for products..." />
                        <button type="submit"><i class="fas fa-search"></i></button>
                    </form>
                </div>
                <div class="header-icons">
                    <a href="cart.html" class="cart-icon">ğŸ›’<span class="cart-count">0</span></a>
                </div>
                <div class="theme-toggle">
                    <i class="fas fa-moon"></i>
                    <i class="fas fa-sun"></i>
                </div>
                <div class="language-toggle">
                    <button class="language-toggle-btn" title="åˆ‡æ›èªè¨€ / Switch Language">ğŸŒ</button>
                    <div class="language-dropdown">
                        <button class="language-option active" data-lang="zh">ä¸­æ–‡</button>
                        <button class="language-option" data-lang="en">ENG</button>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <section class="search-results" style="padding: 80px 0;">
        <div class="container">
            <h2 id="searchTitle" style="color: #ffd700; margin-bottom: 40px;"><span class="lang-zh">æœå°‹çµæœ</span><span class="lang-en">Search Results</span></h2>
            <div class="product-grid" id="searchResults">
                <!-- Results will be populated by JavaScript -->
            </div>
            <p id="noResults" style="display: none; text-align: center; color: #aaa; font-size: 18px;" class="lang-zh">
                æ‰¾ä¸åˆ°å•†å“ã€‚
            </p>
            <p id="noResultsEn" style="display: none; text-align: center; color: #aaa; font-size: 18px;" class="lang-en">
                No products found.
            </p>
        </div>
    </section>

    <footer>
        <div class="container">
            <div class="footer-section">
                <h3>Neon</h3>
                <p class="lang-zh">æ‚¨çš„çµ‚æ¥µ KPOP ç›®çš„åœ° - å°‡ K-pop æ–‡åŒ–å¸¶å…¥ç”Ÿæ´»ã€‚</p>
                <p class="lang-en">We bring joy and spark creativity for kids of all ages.</p>
            </div>
            <div class="footer-section">
                <h3 class="lang-zh">å…¬å¸</h3>
                <h3 class="lang-en">COMPANY</h3>
                <ul><li><a href="about-page.html"><span class="lang-zh">é—œæ–¼æˆ‘å€‘</span><span class="lang-en">About</span></a></li><li><a href="features.html"><span class="lang-zh">ç‰¹è‰²</span><span class="lang-en">Features</span></a></li><li><a href="works.html"><span class="lang-zh">ä½œå“</span><span class="lang-en">Works</span></a></li><li><a href="career.html"><span class="lang-zh">è·æ¥­</span><span class="lang-en">Career</span></a></li></ul>
            </div>
            <div class="footer-section">
                <h3 class="lang-zh">å¹«åŠ©</h3>
                <h3 class="lang-en">HELP</h3>
                <ul><li><a href="support.html"><span class="lang-zh">å®¢æˆ¶æ”¯æ´</span><span class="lang-en">Customer Support</span></a></li><li><a href="delivery.html"><span class="lang-zh">é…é€è©³æƒ…</span><span class="lang-en">Delivery Details</span></a></li><li><a href="terms.html"><span class="lang-zh">æ¢æ¬¾èˆ‡æ¢ä»¶</span><span class="lang-en">Terms & Conditions</span></a></li><li><a href="terms.html"><span class="lang-zh">éš±ç§æ”¿ç­–</span><span class="lang-en">Privacy Policy</span></a></li></ul>
            </div>
            <div class="footer-section">
                <h3>FAQ</h3>
                <ul><li><a href="faq-account.html"><span class="lang-zh">å¸³æˆ¶</span><span class="lang-en">Account</span></a></li><li><a href="faq-orders.html"><span class="lang-zh">ç®¡ç†é…é€</span><span class="lang-en">Manage Deliveries</span></a></li><li><a href="faq-orders.html"><span class="lang-zh">è¨‚å–®</span><span class="lang-en">Orders</span></a></li><li><a href="faq-payments.html"><span class="lang-zh">ä»˜æ¬¾</span><span class="lang-en">Payments</span></a></li></ul>
            </div>
        </div>
        <div class="footer-bottom">
            <p>Â© 2000-2025 Neon. All Rights Reserved.</p>
        </div>
    </footer>

    <script src="common.js"></script>
    <script src="script.js"></script>
    <script>
        // Security functions
        function escapeHtml(text) {
            if (text === null || text === undefined) return '';
            const div = document.createElement('div');
            div.textContent = String(text);
            return div.innerHTML;
        }

        function validateProduct(p) {
            if (!p || typeof p !== 'object') return null;
            return {
                id: String(p.id || ''),
                name: String(p.name || ''),
                price: parseFloat(p.price) || 0,
                images: Array.isArray(p.images) ? p.images.filter(img => typeof img === 'string') : (p.img ? [String(p.img)] : [])
            };
        }

        // Search functionality
        document.addEventListener('DOMContentLoaded', () => {
            // Load saved theme
            const savedTheme = localStorage.getItem('theme') || 'dark-mode';
            document.body.classList.remove('dark-mode', 'light-mode');
            document.body.classList.add(savedTheme);
            
            // Get search query from URL
            const urlParams = new URLSearchParams(window.location.search);
            const query = urlParams.get('query') || '';
            
            // Set search input value
            const searchInput = document.getElementById('searchInput');
            if (searchInput) searchInput.value = query;
            
            // Update title
            const searchTitle = document.getElementById('searchTitle');
            if (query) {
                searchTitle.textContent = `Search Results for "${query}"`;
            }
            
            // Search products (use displayProducts if available, otherwise products)
            if (query) {
                const productsToSearch = typeof displayProducts !== 'undefined' ? displayProducts : products;
                const searchResults = productsToSearch.filter(p => 
                    p.name.toLowerCase().includes(query.toLowerCase())
                );
                
                const resultsContainer = document.getElementById('searchResults');
                const noResults = document.getElementById('noResults');
                
                if (searchResults.length === 0) {
                    resultsContainer.innerHTML = '';
                    noResults.style.display = 'block';
                } else {
                    noResults.style.display = 'none';
                    resultsContainer.innerHTML = '';
                    
                    // Safely render products using DOM methods
                    searchResults.forEach(rawProduct => {
                        const p = validateProduct(rawProduct);
                        if (!p || !p.id) return;
                        
                        const images = p.images.length > 0 ? p.images : getProductImages(p.name) || [];
                        const firstImage = images[0] || '';
                        
                        const productDiv = document.createElement('div');
                        productDiv.className = 'product';
                        productDiv.dataset.productId = p.id;
                        
                        const imageContainer = document.createElement('div');
                        imageContainer.className = 'product-image-container';
                        
                        const productImage = document.createElement('div');
                        productImage.className = 'product-image';
                        if (firstImage) {
                            productImage.style.backgroundImage = `url('${firstImage.replace(/'/g, "\\'")}')`;
                        }
                        productImage.dataset.images = JSON.stringify(images);
                        imageContainer.appendChild(productImage);
                        
                        if (images.length > 1) {
                            const indicators = document.createElement('div');
                            indicators.className = 'image-indicators';
                            images.forEach((_, idx) => {
                                const dot = document.createElement('span');
                                dot.className = `image-dot ${idx === 0 ? 'active' : ''}`;
                                dot.dataset.index = String(idx);
                                indicators.appendChild(dot);
                            });
                            imageContainer.appendChild(indicators);
                        }
                        
                        productDiv.appendChild(imageContainer);
                        
                        const h4 = document.createElement('h4');
                        h4.textContent = p.name;
                        productDiv.appendChild(h4);
                        
                        const priceP = document.createElement('p');
                        priceP.textContent = `$${p.price.toFixed(2)}`;
                        productDiv.appendChild(priceP);
                        
                        const addBtn = document.createElement('button');
                        addBtn.className = 'add-to-cart';
                        addBtn.dataset.id = p.id;
                        addBtn.dataset.name = p.name;
                        addBtn.dataset.price = String(p.price);
                        addBtn.dataset.images = JSON.stringify(images);
                        addBtn.textContent = 'Add to Cart';
                        productDiv.appendChild(addBtn);
                        
                        resultsContainer.appendChild(productDiv);
                    });
                    
                    // Add image rotation on hover
                    resultsContainer.querySelectorAll('.product-image').forEach(imgEl => {
                        const images = JSON.parse(imgEl.dataset.images || '[]');
                        if (images.length > 1) {
                            let currentIndex = 0;
                            let rotationInterval;
                            
                            imgEl.closest('.product').addEventListener('mouseenter', () => {
                                rotationInterval = setInterval(() => {
                                    currentIndex = (currentIndex + 1) % images.length;
                                    imgEl.style.backgroundImage = `url('${images[currentIndex]}')`;
                                    // Update indicators
                                    const dots = imgEl.closest('.product').querySelectorAll('.image-dot');
                                    dots.forEach((dot, idx) => {
                                        dot.classList.toggle('active', idx === currentIndex);
                                    });
                                }, 2000); // Change image every 2 seconds
                            });
                            
                            imgEl.closest('.product').addEventListener('mouseleave', () => {
                                if (rotationInterval) {
                                    clearInterval(rotationInterval);
                                }
                                currentIndex = 0;
                                imgEl.style.backgroundImage = `url('${images[0]}')`;
                                const dots = imgEl.closest('.product').querySelectorAll('.image-dot');
                                dots.forEach((dot, idx) => {
                                    dot.classList.toggle('active', idx === 0);
                                });
                            });
                        }
                    });
                    
                    // Add event listeners to add-to-cart buttons
                    let cart = JSON.parse(localStorage.getItem('cart') || '[]');
                    document.querySelectorAll('.add-to-cart').forEach(btn => {
                        btn.addEventListener('click', () => {
                            const id = btn.dataset.id;
                            const images = JSON.parse(btn.dataset.images || '[]');
                            const item = cart.find(i => i.id === id);
                            if (item) {
                                item.qty++;
                            } else {
                                cart.push({
                                    id, 
                                    name: btn.dataset.name, 
                                    price: +btn.dataset.price, 
                                    images: images,
                                    img: images[0] || '',
                                    selectedColor: images.length > 1 ? 'Color 1' : 'Default',
                                    selectedImage: images[0] || '',
                                    qty: 1
                                });
                            }
                            localStorage.setItem('cart', JSON.stringify(cart));
                            updateCartCount();
                        });
                    });
                }
            } else {
                document.getElementById('searchResults').innerHTML = '';
                document.getElementById('noResults').style.display = 'block';
                document.getElementById('noResults').textContent = 'Please enter a search query.';
            }
            
            // Update cart count
            function updateCartCount() {
                const cart = JSON.parse(localStorage.getItem('cart') || '[]');
                const count = cart.reduce((sum, i) => sum + i.qty, 0);
                const cartCountEl = document.querySelector('.cart-count');
                if (cartCountEl) cartCountEl.textContent = count;
            }
            updateCartCount();
        });
    </script>
</body>
</html>

